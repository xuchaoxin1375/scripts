

[toc]



## æœ‰ç”¨çš„å‘½ä»¤è¡Œ

### ç½‘ç«™é—´çš„æ•°æ®åˆ†é…è°ƒæ•´ğŸ‘º

å‡è®¾ç”¨æˆ·åœ¨æœ¬åœ°å»ºç«‹äº†4ä¸ªç½‘ç«™(a.com,b.com,c.com,d.com)

æ¯ä»½åˆ†é…äº†7ä»½csv(æ¯ä»½1ä¸‡æ¥ç®—,å…±æœ‰7ä¸‡æ•°æ®),ä½†æ˜¯æŸä¸ªç«™çš„å›¾ç‰‡ä¸‹è½½å¼‚å¸¸(æ¯”å¦‚é“¾æ¥å¤±æ•ˆ,æˆ–è€…ä¸‹è½½å›¾ç‰‡éƒ½æ˜¯ç ´å›¾æˆ–è€…å‹æ ¹å°±æ‰“ä¸å¼€æˆ–ä¸‹ä¸åŠ¨),è¿™ç§æƒ…å†µä¸‹,å¦‚æœå›¾ç‰‡å¼‚å¸¸çš„æ•°é‡è¾¾åˆ°2ä¸‡ä»¥ä¸Š,æ„å‘³ç€è¿™ä¸ªç«™(æ¯”å¦‚a.com)æ•°æ®å°†ä¸å¤Ÿ

å¦‚æœå…¶ä»–ç«™(æ¯”å¦‚b.com)æ•°æ®æ¯”è¾ƒå……è£•(ä¸‹è½½å›¾ç‰‡å,æ•°é‡æŸå¤±ä¸è¶…è¿‡1ä¸‡),å¯ä»¥è€ƒè™‘å°†å…¶ä¸­çš„ä¸€ä»½csvç§»åŠ¨åˆ°a.comä¸­è°ƒèŠ‚

ç§»åŠ¨åˆ†ä¸ºä¸¤éƒ¨åˆ†,é¦–å…ˆä¸€ä¸ªæ˜¯ç§»åŠ¨å›¾ç‰‡(è¿™ä¸ªå·¥ç¨‹é‡æ¯”è¾ƒå¤§,å¦‚æœå›¾ç‰‡åæ˜¯æŒ‰ç…§æœ‰åºç¼–å·skuå¼€å¤´,å¯ä»¥å°†å›¾ç‰‡æŒ‰ç…§åå­—æ’åº,ç„¶åæŒ‡å®šåŒºé—´å†…skuçš„å›¾æ‰¹é‡é€‰ä¸­,å‰ªåˆ‡åˆ°å¦ä¸€ä¸ªç«™,å†æŠŠcsvç§»åŠ¨åˆ°å¯¹åº”åˆ°ç«™çš„csvç›®å½•ä¸­)

å…¶ä¸­ç§»åŠ¨å›¾ç‰‡çš„æ–¹æ¡ˆè¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ–¹å¼ç§»åŠ¨`Move-ItemFromCsvPathFields -Path ... -SourceDir ... -Destination ...`

```bash

#ä¿®æ”¹é…ç½®(å›¾ç‰‡ä»å“ªä¸ªç«™ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç«™ç‚¹)
$fromDomain = "domain1.com"
$toDomain = "domain2.com"
$csv = "p44.csv" #ä¿®æ”¹ä¸ºè¦ç§»åŠ¨çš„csvæ–‡ä»¶å
$csvFullPath = "$Desktop\data_output\$fromDomain\$csv"
# å¼€å§‹å¤„ç†
$csvfrom = "$Desktop\data_output\$fromDomain\$csv"
$csvdest = "$Desktop\data_output\$toDomain\$csv"
Move-ItemImagesFromCsvPathFields -Path $csvFullPath -UseDomainNamePair $fromDomain, $toDomain  -ImgExtPattern '.webp' -Verbose # -IgnoreExtension

#ç§»åŠ¨csv
Move-Item $csvfrom $csvdest -V

```

## å…¶ä»–

### ç»Ÿè®¡jpg,pngå›¾ç‰‡æˆ–éwebpå›¾ç‰‡æ•°

åˆ©ç”¨findæ¥ç»Ÿè®¡

```bash
find . -type f ! -name "*.webp" | wc -l
```

æˆ–è€…ä¸€ä¸ªä¸å¤ªå‡†ç¡®çš„æ–¹æ³•(å®¹æ˜“ç®—é”™)

```bash
ls *png *jpg |wc -l
```



### åˆ é™¤ç›®å½•ä¸­çš„éwebpæ–‡ä»¶ğŸˆ

powershellä¸­åœ¨å›¾ç‰‡ç›®å½•ä¸‹æ‰§è¡Œ:

```powershell
ls -File |?{$_ -notlike '*.webp'}|rm -Verbose

```

åˆ©ç”¨findåˆ é™¤

```bash
find . -type f ! -name "*.webp" -delete
```



å…¶ä»–æ–¹æ¡ˆ

bashä¸­åˆ é™¤éwebpå›¾ç‰‡

```bash
shopt -s extglob
rm !(*.webp) 
```

ä»…åˆ é™¤jpg,pngå›¾ç‰‡

```bash
rm *.jpg *.png
```

### å°†æŒ‡å®šç›®å½•ä¸‹çš„jpg,pngç­›é€‰å‡ºæ¥å¹¶å¤„ç†

å¯ä»¥é…åˆpowershellå®Œæˆæ­¤ä»»åŠ¡

```powershell
ls *jpg,*png|% FullName > $home/jpn.txt ;
python $pys\image_compresser.py   -R auto -p -F  -O -k -f webp  -r 1000 800  -I $home/jpn.txt

```



### å°†jpg,pngå›¾ç‰‡åç¼€é‡å‘½åä¸ºwebpğŸˆ

powershellè¿›å…¥åˆ°åˆ¶å®šç›®å½•(éœ€è¦è¢«é‡å‘½åæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•)ä¸‹,ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤

```powershell
# æ ‡å‡†å†™æ³•(Rename-Item ä½äºç®¡é“ç¬¦ä¹‹å,ä¸”-newNameçš„å‚æ•°æ˜¯ä»£ç å—,ä½¿ç”¨$_.Nameè·å–æ–‡ä»¶åå­—ç¬¦ä¸²)
# å…¶ä¸­'\.jpg$'æ˜¯æ­£åˆ™è¡¨è¾¾å¼,åŒ¹é…æ–‡ä»¶åä¸­çš„åç¼€éƒ¨åˆ†(\.æ˜¯å°æ•°ç‚¹çš„è½¬ä¹‰,è¡¨ç¤º.å·æœ¬èº«,ä½œä¸ºä¸€ä¸ªæ•´ä½“,$å·è¡¨ç¤ºä»…åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾çš„æƒ…å†µ)
ls -File |Rename-Item -NewName {$_.Name -replace '\.jpg$','.webp' }
```

å¦ä¸€ç§æ›´åŠ ç›´ç™½çš„å†™æ³•

```powershell
ls *.jpg,*.png|%{ rni -Path $_ -NewName ((Split-Path -LeafBase $_).ToString()+".webp") -Verbose}

```

å¯¹äºç¬¬ä¸€ç§å†™æ³•,å¯ä»¥æ–¹ä¾¿åœ°æ‰©å±•æ›´å¤šçš„ç”¨æ³•,ä¾‹å¦‚å°†æ–‡ä»¶å(å†…éƒ¨éè¾¹ç¼˜)ä¸­çš„`.php`å­—ç¬¦ä¸²æ›¿æ¢ä¸º`_php`(wordpressä¸­å›¾ç‰‡è·¯å¾„åŒ…å«`.php`æ—¶,ä¼šè¢«è§£é‡Šä¸ºphpè„šæœ¬,å¯¼è‡´é”™è¯¯è§£é‡Š,å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹æ³•æ›¿æ¢æ–‡ä»¶å,å¦‚æœæ–‡ä»¶åæœ¬èº«å°±ä¸€`.php`ç»“å°¾,åˆ™ä¿ç•™ä¸å˜)

```powershell
ls -File |Rename-Item -NewName {$_.Name -replace '(\.php)(?!$)','_php' }
```

å°†å›¾ç‰‡åä¸­çš„`%`æ›¿æ¢ä¸º`_`

```powershell
ls *%*| Rename-Item -NewName { $_.Name -replace '%','_' } -Verbose
```

### å°†åç¼€ç¼ºå¤±çš„æ–‡ä»¶æ·»åŠ é»˜è®¤åç¼€.webp

```powershell
Get-ChildItem | Where-Object { $_ -notlike "*.webp" } | ForEach-Object { Rename-Item -Path $_ -NewName ($_.Name + ".webp") -Verbose }

```



### wp-cliç›¸å…³å‘½ä»¤ğŸˆ

ä¾‹å¦‚æ‰¹é‡æ“ä½œæ’ä»¶(å®‰è£…/å¸è½½/æ›´æ–°/ç¦ç”¨/å¯ç”¨,æˆ–è€…ç®¡ç†å‘˜è´¦å·å¯†ç æ›´æ–°)çš„å®Œæ•´å’Œæ ‡å‡†æ“ä½œ,å¯ä»¥åˆ©ç”¨wpå‘½ä»¤è¡Œæ¥æ‰§è¡Œ

ç›¸å…³ç”¨ä¾‹å¦è§å®ƒæ–‡ [sh/Readme@sh](../sh/Readme@sh.md)



### æ‰¹é‡ä¸‹è½½gz(sitemap gz)

è¯¦è§403åé‡‡



## æ‰¹é‡è¿è¡Œwpå‘½ä»¤è¡Œ

æ ¹æ®éœ€è¦ç¨ä½œä¿®æ”¹ä¸‹é¢çš„bashè„šæœ¬æ¨¡æ¿å³å¯

```bash
#!/bin/bash


BASE_DIR="/www/wwwroot" #æ ¹æ®éœ€è¦ä¿®æ”¹(ç½‘ç«™æ ¹ç›®å½•æ˜¯å¦æœ‰wordpresså±‚ä¹Ÿè¦æ³¨æ„ä¿®æ”¹)
MAX_JOBS=32 #æ ¹æ®éœ€è¦ä¿®æ”¹
job_count=0
# è®©rootç”¨æˆ·ä¸‹å¯ä»¥å€Ÿç”¨æ™®é€šç”¨æƒé™è¿›è¡Œå®‰å…¨wp cliæ“ä½œ
wp() {
  	user='www' #ä¿®æ”¹ä¸ºä½ çš„ç³»ç»Ÿä¸Šå­˜åœ¨çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·çš„åå­—,æ¯”å¦‚å®å¡”ç”¨æˆ·å¯ä»¥ä½¿ç”¨www
    echo "[INFO] Executing as user '$user':wp $*"
    sudo -u $user wp "$@"
    local EXIT_CODE=$?
    return $EXIT_CODE
}
for wpdir in $(find "$BASE_DIR" -type d -path "*/wordpress" -maxdepth 3); do
    (
        echo "æ­£åœ¨å¤„ç†: $wpdir"
        cd "$wpdir"
        if [ -f "$wpdir/wp-config.php" ]; then
            # åœ¨ä¸‹é¢å®šä¹‰éœ€è¦æ‰§è¡Œçš„wp_cliå‘½ä»¤è¡Œ
            # ç¦ç”¨ wp-cron
            # sudo -u www  wp config set DISABLE_WP_CRON true --raw --path="$wpdir"

            # ç¦ç”¨è‡ªåŠ¨æ›´æ–°
            # sudo -u www wp config set AUTOMATIC_UPDATER_DISABLED true --raw
            # sudo -u www wp config set WP_AUTO_UPDATE_CORE false --raw
            
            # é‡ç½®astraä¸»é¢˜ä¸­woocommerceè´­ç‰©è½¦æŒ‰é’®æ–‡æœ¬(å…³é—­æ–‡ä»¶è‡ªå®šä¹‰ä½¿ç”¨æ¨¡æ¿è¯­è¨€çš„é»˜è®¤å€¼)
            # sudo -u www wp eval '
            # $settings = get_option("astra-settings", array());
            # unset($settings["woo-cart-button-text"]);
            # update_option("astra-settings", $settings);
            # '

            if [ $? -eq 0 ]; then
                echo "  âœ… æˆåŠŸæ‰§è¡Œwpå‘½ä»¤"
            else
                echo "  âŒ è®¾ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯¥ç›®å½•çš„æƒé™æˆ– WP å®‰è£…æƒ…å†µ"
            fi
        else
            echo "  âš ï¸ æœªæ‰¾åˆ° wp-config.phpï¼Œè·³è¿‡"
        fi
    ) &
    job_count=$((job_count+1))
    if [ "$job_count" -ge "$MAX_JOBS" ]; then
        wait
        job_count=0
    fi
done
wait
```

