[toc]





## ç»†èŠ‚

### ä¼šè¯å¯¹è±¡

**åˆå§‹åŒ–ä¼šè¯**ï¼š

```python
self.session = requests.Session()
```



- **ä¼šè¯ç®¡ç†**ï¼šåˆ›å»ºä¸€ä¸ª`requests.Session`å¯¹è±¡ï¼Œç”¨äºç®¡ç†HTTPä¼šè¯ã€‚
- **æŒä¹…è¿æ¥**ï¼š`requests.Session`ä¼šä¿æŒè¿æ¥çš„æŒä¹…æ€§ï¼Œè¿™æ„å‘³ç€åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­è¿›è¡Œå¤šæ¬¡è¯·æ±‚æ—¶ï¼Œå¯ä»¥é‡ç”¨TCPè¿æ¥ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚
- **ä¼šè¯çº§åˆ«çš„é…ç½®**ï¼šä½ å¯ä»¥åœ¨è¿™ä¸ªä¼šè¯å¯¹è±¡ä¸Šè®¾ç½®ä¸€äº›ä¼šè¯çº§åˆ«çš„é…ç½®ï¼Œå¦‚é»˜è®¤çš„è¯·æ±‚å¤´ã€Cookieã€è¶…æ—¶æ—¶é—´ç­‰ã€‚

### è®¾ç½®é»˜è®¤è¯·æ±‚å¤´

```python
self.session.headers.update(self.headers)
```



- **è‡ªå®šä¹‰User-Agent**ï¼šé€šè¿‡`self.headers`ä¸­çš„`"User-Agent"`é”®å€¼å¯¹ï¼Œè®¾ç½®è‡ªå®šä¹‰çš„User-Agentã€‚è¿™å¯ä»¥æ¨¡æ‹Ÿä¸åŒçš„æµè§ˆå™¨æˆ–å®¢æˆ·ç«¯ï¼Œæœ‰æ—¶å¯ä»¥é¿å…è¢«æŸäº›ç½‘ç«™çš„åçˆ¬è™«æœºåˆ¶é˜»æ­¢ã€‚
- **å…¶ä»–è¯·æ±‚å¤´**ï¼šé™¤äº†User-Agentï¼Œä½ è¿˜å¯ä»¥åœ¨`self.headers`ä¸­è®¾ç½®å…¶ä»–è¯·æ±‚å¤´ä¿¡æ¯ï¼ˆå¦‚`Accept`ã€`Accept-Language`ç­‰ï¼‰ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æœåŠ¡å™¨æ›´å¥½åœ°å¤„ç†ä½ çš„è¯·æ±‚ã€‚
- **ä¸€è‡´æ€§**ï¼šåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šä½¿ç”¨ç›¸åŒçš„è¯·æ±‚å¤´ï¼Œé™¤éä½ åœ¨ç‰¹å®šè¯·æ±‚ä¸­è¦†ç›–è¿™äº›å¤´ä¿¡æ¯ã€‚

### ç¤ºä¾‹

å‡è®¾ä½ çš„`self.headers`å¦‚ä¸‹ï¼š

```python
self.headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3"}
```



é‚£ä¹ˆåœ¨åˆå§‹åŒ–ä¼šè¯å¹¶æ›´æ–°è¯·æ±‚å¤´åï¼Œæ‰€æœ‰é€šè¿‡è¿™ä¸ªä¼šè¯å‘èµ·çš„è¯·æ±‚éƒ½ä¼šåŒ…å«è¿™ä¸ªè‡ªå®šä¹‰çš„User-Agentã€‚

```python
self.session = requests.Session()
self.session.headers.update(self.headers)

# å‘èµ·ä¸€ä¸ªè¯·æ±‚
response = self.session.get('https://example.com/image.jpg')
```



åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`response`çš„è¯·æ±‚ä¼šè‡ªåŠ¨åŒ…å«`self.headers`ä¸­å®šä¹‰çš„User-Agentã€‚

### æ€»ç»“

- **åˆå§‹åŒ–ä¼šè¯**ï¼šåˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„HTTPä¼šè¯å¯¹è±¡ã€‚
- **è®¾ç½®é»˜è®¤è¯·æ±‚å¤´**ï¼šç¡®ä¿æ‰€æœ‰è¯·æ±‚ä½¿ç”¨ç›¸åŒçš„è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œæé«˜è¯·æ±‚çš„ä¸€è‡´æ€§å’Œå¯èƒ½çš„æ€§èƒ½ä¼˜åŒ–ã€‚

è¿™æ ·åšæœ‰åŠ©äºæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿç¡®ä¿äº†è¯·æ±‚çš„ä¸€è‡´æ€§ã€‚

## urlparseæ¨¡å—çš„ä½¿ç”¨

[urllib.parse --- å°† URL è§£æä¸ºç»„ä»¶ â€” Python 3.13.3 æ–‡æ¡£](https://docs.python.org/zh-cn/3.13/library/urllib.parse.html)

`urlparse` æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºè§£æ URL å­—ç¬¦ä¸²ä¸ºç»„ä»¶ï¼ˆå¦‚åè®®ã€åŸŸåã€è·¯å¾„ã€å‚æ•°ç­‰ï¼‰ï¼Œä¾¿äºå¯¹ URL è¿›è¡Œåˆ†æå’Œæ“ä½œã€‚å®ƒåœ¨ Python 2 ä¸­æ˜¯ `urlparse` æ¨¡å—ï¼Œåœ¨ Python 3 ä¸­è¢«æ•´åˆåˆ° `urllib.parse` æ¨¡å—ä¸­ã€‚

åœ¨ **Python 3** ä¸­ï¼Œä½ åº”è¯¥ä½¿ç”¨ï¼š

```python
from urllib.parse import urlparse
```

---

### ğŸ§© åŸºæœ¬ç”¨æ³•

- `urlparse(urlstring, scheme='', allow_fragments=True)`

#### å‚æ•°è¯´æ˜ï¼š

- `urlstring`: éœ€è¦è§£æçš„ URL å­—ç¬¦ä¸²ã€‚
- `scheme`: é»˜è®¤åè®®ï¼ˆå¦‚æœ URL ä¸­æ²¡æœ‰æŒ‡å®šçš„è¯ï¼‰ã€‚
- `allow_fragments`: æ˜¯å¦å…è®¸ URL ç‰‡æ®µï¼ˆå³ `#xxx` éƒ¨åˆ†ï¼‰ã€‚

#### è¿”å›å€¼ï¼š

è¿”å›ä¸€ä¸ª `ParseResult` å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š

| å±æ€§å     | å«ä¹‰                          |
| ---------- | ----------------------------- |
| `scheme`   | åè®®ï¼ˆå¦‚ httpã€httpsï¼‰        |
| `netloc`   | ç½‘ç»œä½ç½®ï¼ˆåŸŸå/IP + ç«¯å£ï¼‰    |
| `path`     | è·¯å¾„éƒ¨åˆ†                      |
| `params`   | è·¯å¾„å‚æ•°ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰          |
| `query`    | æŸ¥è¯¢å‚æ•°ï¼ˆå³ `?` åé¢çš„å†…å®¹ï¼‰ |
| `fragment` | ç‰‡æ®µæ ‡è¯†ï¼ˆå³ `#` åé¢çš„éƒ¨åˆ†ï¼‰ |

---

### ğŸ“Œ ç¤ºä¾‹ä»£ç ï¼š

```python
from urllib.parse import urlparse

url = "https://www.example.com:8080/path/to/page?name=value&key=123#section-2"
parsed = urlparse(url)

print("Scheme:", parsed.scheme)
print("Netloc:", parsed.netloc)
print("Path:", parsed.path)
print("Params:", parsed.params)
print("Query:", parsed.query)
print("Fragment:", parsed.fragment)
```

#### è¾“å‡ºç»“æœï¼š

```
Scheme: https
Netloc: www.example.com:8080
Path: /path/to/page
Params: 
Query: name=value&key=123
Fragment: section-2
```

---

### ğŸ” åå‘æ“ä½œï¼šå°†è§£æåçš„ç»“æœç»„åˆæˆ URL

å¯ä»¥ä½¿ç”¨ `urlunparse()` å°† `ParseResult` æˆ–å…ƒç»„é‡æ–°ç»„åˆä¸º URLï¼š

```python
from urllib.parse import urlunparse

data = ('https', 'www.example.com:8080', '/path/to/page', '', 'name=value&key=123', 'section-2')
url = urlunparse(data)
print(url)
```

è¾“å‡ºï¼š

```
https://www.example.com:8080/path/to/page?name=value&key=123#section-2
```

---

### ğŸ§  è¡¥å……è¯´æ˜ï¼š

- å¦‚æœä½ åªæƒ³è·å–æŸ¥è¯¢å‚æ•°éƒ¨åˆ†ï¼Œå¹¶è¿›ä¸€æ­¥è§£æé”®å€¼å¯¹ï¼Œå¯ä»¥é…åˆ `parse_qs()` æˆ– `parse_qsl()` ä½¿ç”¨ï¼š

```python
from urllib.parse import parse_qs

query = parsed.query
params = parse_qs(query)
print(params)
```

è¾“å‡ºï¼š

```
{'name': ['value'], 'key': ['123']}
```

---

### ğŸš« æ³¨æ„äº‹é¡¹ï¼š

- `urlparse` ä¸ä¼šéªŒè¯ URL çš„åˆæ³•æ€§ï¼Œåªè´Ÿè´£è§£ææ ¼å¼ã€‚
- å¯¹äºç›¸å¯¹è·¯å¾„æˆ–ä¸å®Œæ•´çš„ URLï¼Œå¯ä»¥ä¼ å…¥é»˜è®¤ `scheme` æ¥è¾…åŠ©è§£æã€‚

---

å¦‚æœä½ æ­£åœ¨å¤„ç†ç½‘ç»œçˆ¬è™«ã€API è¯·æ±‚è§£ææˆ–é“¾æ¥æå–ä»»åŠ¡ï¼Œ`urlparse`ï¼ˆæˆ– Python 3 çš„ `urllib.parse.urlparse`ï¼‰æ˜¯éå¸¸å®ç”¨çš„å·¥å…·ã€‚

## urlç™¾åˆ†å·è§£ç ğŸˆ

[urllib.parse --- å°† URL è§£æä¸ºç»„ä»¶ unquote â€” Python  æ–‡æ¡£](https://docs.python.org/zh-cn/3.13/library/urllib.parse.html#urllib.parse.unquote)

`unquote` æ˜¯ Python ä¸­ `urllib.parse` æ¨¡å—æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¸¸ç”¨äºè§£ç  URL ç¼–ç ï¼ˆä¹Ÿç§°ä½œç™¾åˆ†å·ç¼–ç ï¼‰çš„å­—ç¬¦ä¸²ã€‚åœ¨ URL ä¸­ï¼ŒæŸäº›ç‰¹æ®Šå­—ç¬¦éœ€è¦è¿›è¡Œç¼–ç ä»¥ç¡®ä¿ä¼ è¾“å®‰å…¨ï¼Œä¾‹å¦‚ç©ºæ ¼ä¼šè¢«ç¼–ç æˆ `%20`ã€‚

### ä¸»è¦åŠŸèƒ½

- å°† URL ç¼–ç çš„å­—ç¬¦ä¸²è½¬æ¢å›åŸå§‹å­—ç¬¦ä¸²ã€‚
- è§£ç è§„åˆ™æ˜¯å°† `%xx` æ›¿æ¢ä¸ºå¯¹åº”çš„å­—èŠ‚å€¼ï¼Œä¾‹å¦‚ `%3F` è¢«æ›¿æ¢ä¸º `?`ã€‚

å½“ä½ é‡åˆ°ä¸€ä¸ªåŒ…å«`%`çš„urlæ—¶,é€šå¸¸æ˜¯ç‰¹æ®Šå­—ç¬¦è¢«ç¼–ç æˆ`%xx`çš„å½¢å¼,äººç±»éš¾ä»¥ç›´æ¥é˜…è¯»,ä½ å¯ä»¥ä½¿ç”¨`unquote`å°†`%xx`è§£ç å›äººç±»å¯è¯»çš„å­—ç¬¦

ä¾‹å¦‚ä½ éœ€è¦æ ¹æ®ä¸€ä¸ªurlé“¾æ¥è·å–æ”¹urlä»£è¡¨çš„èµ„æºçš„åç§°,å¦‚æœurlä¸­æœ‰%ç¼–ç å°±ä¸å®¹æ˜“é˜…è¯»,å› æ­¤å¯ä»¥è€ƒè™‘å¯¹å…¶è¿›è¡Œè§£ç 

### è¯­æ³•

```
python

urllib.parse.unquote(string, encoding='utf-8', errors='replace')
```

### å‚æ•°è¯´æ˜

1. **string**: éœ€è¦è§£ç çš„å­—ç¬¦ä¸²ã€‚
2. **encoding**: è¾“å…¥å­—ç¬¦ä¸²ä½¿ç”¨çš„ç¼–ç ï¼Œé»˜è®¤æ˜¯ `'utf-8'`ã€‚
3. **errors**: å¤„ç†è§£ç å¤±è´¥æ—¶çš„æ–¹å¼ï¼Œé»˜è®¤æ˜¯ `'replace'`ï¼Œä¹Ÿå¯ä»¥é€‰æ‹© `'strict'` æˆ– `'ignore'`ã€‚

### è¿”å›å€¼

è¿”å›è§£ç åçš„å­—ç¬¦ä¸²ã€‚

### ç¤ºä¾‹ä»£ç 

```python
pythonfrom urllib.parse import unquote

encoded_str = "Hello%21%20World%3F"
decoded_str = unquote(encoded_str)
print(decoded_str)  # è¾“å‡º: Hello! World?
```

åˆæ¯”å¦‚:

```python
from urllib.parse import unquote

encoded = "https://www.example.com/search?q=%E5%92%96%E5%95%A1%E6%9C%BA"
decoded = unquote(encoded)
print(decoded)  # è¾“å‡º: https://www.example.com/search?q=å’–å•¡æœº
# è¿™é‡Œ%E5%92%96%E5%95%A1%E6%9C%BAäººç±»éš¾ä»¥ç›´æ¥é˜…è¯»,å°†å…¶è§£ç å,å¾—åˆ°"å’–å•¡æœº"
```



### å¸¸è§ç”¨é€”

1. è§£æ URL æŸ¥è¯¢å‚æ•°æ—¶ï¼Œå»é™¤ URL ç¼–ç ã€‚
2. å¤„ç†ä»ç½‘é¡µè¡¨å•æäº¤çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®é€šå¸¸ä¼šç»è¿‡ URL ç¼–ç ã€‚
3. åœ¨æ„å»º API è¯·æ±‚æ—¶ï¼Œå¯¹æœåŠ¡å™¨è¿”å›çš„ URL ç¼–ç å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚

### æ³¨æ„äº‹é¡¹

- å¦‚æœè¾“å…¥å­—ç¬¦ä¸²ä¸­åŒ…å«æ— æ•ˆçš„ç™¾åˆ†æ¯”ç¼–ç ï¼ˆå¦‚ `%zz`ï¼‰ï¼Œ`unquote` é»˜è®¤ä¼šå°è¯•ç”¨æ›¿ä»£å­—ç¬¦å¤„ç†ï¼Œå…·ä½“è¡Œä¸ºç”± `errors` å‚æ•°å†³å®šã€‚
- å¦‚æœç¼–ç æ ¼å¼ä¸æ˜¯ UTF-8ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®š `encoding` å‚æ•°ã€‚



## æ¢æµ‹è¯·æ±‚å¤´|http headè¯·æ±‚

**å‘é€ä¸€ä¸ª HTTP HEAD è¯·æ±‚**æ¥æ£€æŸ¥ç›®æ ‡å›¾ç‰‡ URL æ˜¯å¦å­˜åœ¨å’Œå¯è®¿é—®ï¼Œè€Œä¸å®é™…ä¸‹è½½æ•´ä¸ªæ–‡ä»¶ã€‚

### ç›¸å…³ä»£ç ç‰‡æ®µ

#### å‘é€headè¯·æ±‚

```python
head_response = self.session.head(
    url=url, timeout=self.timeout, verify=self.verify_ssl
)
```

- **`self.session.head(...)`**ï¼šä½¿ç”¨ `requests.Session()` å‘é€ä¸€ä¸ª **HEAD è¯·æ±‚** åˆ°æŒ‡å®šçš„ `url`ã€‚
- **`timeout=self.timeout`**ï¼šè®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼Œé˜²æ­¢ç¨‹åºå¡æ­»ã€‚
- **`verify=self.verify_ssl`**ï¼šæ§åˆ¶æ˜¯å¦éªŒè¯ SSL è¯ä¹¦ã€‚è‹¥ä¸º `False`ï¼Œåˆ™å¿½ç•¥ HTTPS è¯ä¹¦é”™è¯¯ï¼ˆé€‚ç”¨äºæµ‹è¯•ç¯å¢ƒæˆ–è‡ªç­¾åè¯ä¹¦ï¼‰ã€‚

> HEAD è¯·æ±‚åªä¼šè·å–å“åº”å¤´ï¼ˆheadersï¼‰ï¼Œè€Œä¸ä¼šä¸‹è½½å“åº”ä½“ï¼ˆbodyï¼‰ï¼Œå› æ­¤éå¸¸é«˜æ•ˆï¼Œé€‚åˆç”¨äºæ¢æµ‹èµ„æºæ˜¯å¦å­˜åœ¨ã€‚

---

#### æ ¹æ®ç›¸åº”å†³å®šå¼‚å¸¸æŠ›å‡ºè¡Œä¸º

```python
head_response.raise_for_status()
```

- è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ® HTTP å“åº”çŠ¶æ€ç åˆ¤æ–­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼š
  - å¦‚æœè¿”å›çš„çŠ¶æ€ç æ˜¯ 2xxï¼ˆå¦‚ 200 OKï¼‰ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
  - å¦‚æœæ˜¯ 4xx æˆ– 5xx é”™è¯¯ï¼ˆä¾‹å¦‚ 404ã€500ï¼‰ï¼Œå°±ä¼šæŠ›å‡º `HTTPError` å¼‚å¸¸ï¼Œè¿›å…¥ `except` åˆ†æ”¯ã€‚

---

### ğŸ§  åœ¨ä½ çš„ä»£ç ä¸­èµ·åˆ°çš„ä½œç”¨

åœ¨ `_download_single_image()` æ–¹æ³•ä¸­ï¼š

1. **æå‰æ£€æŸ¥é“¾æ¥æœ‰æ•ˆæ€§**ï¼š
   - é¿å…å¯¹æ— æ•ˆé“¾æ¥è¿›è¡Œå¤§æ–‡ä»¶ä¸‹è½½ï¼ŒèŠ‚çœæ—¶é—´å’Œå¸¦å®½ã€‚
   - æé«˜ç”¨æˆ·ä½“éªŒï¼Œåœ¨çœŸæ­£ä¸‹è½½å‰å°±çŸ¥é“è¿™ä¸ªé“¾æ¥å¯èƒ½æœ‰é—®é¢˜ã€‚

2. **é…åˆé‡è¯•æœºåˆ¶**ï¼š
   - å¦‚æœ HEAD è¯·æ±‚å¤±è´¥ï¼Œä¼šè§¦å‘é‡è¯•é€»è¾‘ï¼ˆæœ€å¤šå°è¯• `retry_times` æ¬¡ï¼‰ã€‚
   - é‡è¯•ä¹‹é—´æœ‰çŸ­æš‚å»¶è¿Ÿï¼Œé¿å…ç¬é—´å¤§é‡è¯·æ±‚å¯¼è‡´è¢«å° IPã€‚

3. **æ—¥å¿—è®°å½•ä¸ç»Ÿè®¡**ï¼š
   - å¦‚æœæœ€ç»ˆ HEAD è¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œåˆ™è®°å½•ä¸ºâ€œä¸‹è½½å¤±è´¥â€ï¼Œå¹¶è®¡å…¥ç»Ÿè®¡ã€‚

---

###  ç¤ºä¾‹è¯´æ˜

å‡è®¾ä½ è¦ä¸‹è½½è¿™å¼ å›¾ç‰‡ï¼š

```python
url = "https://example.com/image.jpg"
```

æ‰§è¡Œï¼š

```python
head_response = self.session.head(url, timeout=30, verify=False)
head_response.raise_for_status()
```

å¯èƒ½å‡ºç°çš„æƒ…å†µï¼š

| çŠ¶æ€ç  | å«ä¹‰                   | raise_for_status() è¡Œä¸º |
| ------ | ---------------------- | ----------------------- |
| 200    | æˆåŠŸï¼Œèµ„æºå­˜åœ¨         | ä¸æŠ›å¼‚å¸¸                |
| 404    | æ–‡ä»¶ä¸å­˜åœ¨             | æŠ›å‡º HTTPError          |
| 500    | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯         | æŠ›å‡º HTTPError          |
| è¶…æ—¶   | æœªæ”¶åˆ°å“åº”ï¼ˆéçŠ¶æ€ç ï¼‰ | æŠ›å‡º Timeout å¼‚å¸¸       |

---

### ğŸ“ æ€»ç»“

| è¡Œä¸º                           | è¯´æ˜                                           |
| ------------------------------ | ---------------------------------------------- |
| ä½¿ç”¨ `head()`                  | åªè¯·æ±‚å¤´éƒ¨ä¿¡æ¯ï¼Œä¸ä¸‹è½½å†…å®¹ï¼Œå¿«é€Ÿæ£€æŸ¥èµ„æºå¯ç”¨æ€§ |
| è®¾ç½® `timeout` å’Œ `verify_ssl` | æ§åˆ¶å®‰å…¨æ€§å’Œç¨³å®šæ€§                             |
| `raise_for_status()`           | è‡ªåŠ¨æŠ›é”™ï¼Œç®€åŒ–å¼‚å¸¸å¤„ç†                         |
| ç»“åˆ `try-except` å’Œé‡è¯•æœºåˆ¶   | å¢å¼ºç½‘ç»œå¥å£®æ€§                                 |

---

### ğŸ’¡ è·³è¿‡headè¯•æ¢è¯·æ±‚

å¦‚æœä½ å¸Œæœ›è¿›ä¸€æ­¥æé«˜æ€§èƒ½ï¼Œå¯ä»¥è·³è¿‡ HEAD è¯·æ±‚ï¼ˆå°¤å…¶åœ¨æ‰¹é‡ä¸‹è½½æ—¶ï¼‰ï¼Œç›´æ¥å¼€å§‹ GET è¯·æ±‚å¹¶ç”¨ `response.headers` è·å–ä¿¡æ¯ã€‚HEAD è¯·æ±‚è™½ç„¶è½»é‡ï¼Œä½†ä»ç„¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚ã€‚

## æ–‡ä»¶è·¯å¾„å’Œæ‰©å±•åå¤„ç†splitext

`os.path.splitext()` æ˜¯ Python æ ‡å‡†åº“ `os.path` æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äº**å°†æ–‡ä»¶è·¯å¾„åˆ†å‰²ä¸ºã€Œæ–‡ä»¶åä¸»ä½“ã€å’Œã€Œæ‰©å±•åã€ä¸¤éƒ¨åˆ†**ã€‚

---

### ğŸ§© å‡½æ•°å®šä¹‰ï¼š

```python
os.path.splitext(path)
```

#### å‚æ•°è¯´æ˜ï¼š

- `path`: ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„æ–‡ä»¶è·¯å¾„ï¼ˆå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ï¼‰ã€‚

#### è¿”å›å€¼ï¼š

è¿”å›ä¸€ä¸ª **å…ƒç»„ `(root, ext)`**ï¼š

- `root`: æ–‡ä»¶ä¸»ä½“ï¼ˆä¸å¸¦æ‰©å±•åçš„éƒ¨åˆ†ï¼‰
- `ext`: æ‰©å±•åï¼ˆåŒ…å«ç‚¹å·`.`ï¼‰

---

###  å…¸å‹ç”¨æ³•ç¤ºä¾‹ï¼š

```python
import os

# ç¤ºä¾‹è·¯å¾„
path = "/home/user/documents/report.txt"

# ä½¿ç”¨ splitext åˆ†å‰²æ–‡ä»¶å
root, ext = os.path.splitext(path)

print("Root:", root)   # è¾“å‡º: /home/user/documents/report
print("Ext:", ext)     # è¾“å‡º: .txt
```

---

### ğŸ” åå‘æ‹¼æ¥ï¼šä½¿ç”¨ `os.path` çš„å…¶ä»–å‡½æ•°

å¦‚æœä½ æƒ³æŠŠæ–‡ä»¶åå’Œæ‰©å±•åé‡æ–°ç»„åˆèµ·æ¥ï¼Œå¯ä»¥ç”¨ `os.path.join()`ï¼š

```python
new_path = os.path.join(root, "backup" + ext)
print(new_path)  # è¾“å‡º: /home/user/documents/report/backup.txt
```

---

### ğŸ“Œ æ³¨æ„äº‹é¡¹ï¼š

#### 1. **åªåˆ†å‰²æœ€åä¸€ä¸ªç‚¹å·**

```python
os.path.splitext("image.version.jpg")
# è¿”å›: ('image.version', '.jpg')
```

åªä¼šæŒ‰æœ€åä¸€ä¸ª `.` åˆ†å‰²ï¼Œä¸ä¼šå½±å“å‰é¢çš„ç‚¹å·ã€‚

#### 2. **æ²¡æœ‰æ‰©å±•åæ—¶ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²**

```python
os.path.splitext("/path/to/file")
# è¿”å›: ('/path/to/file', '')
```

#### 3. **è·¯å¾„ä¸­å«å¤šä¸ªç‚¹å·ä¹Ÿæ²¡é—®é¢˜**

```python
os.path.splitext("data.tar.gz")
# è¿”å›: ('data.tar', '.gz')
```

> âš ï¸ å¦‚æœä½ å¸Œæœ›å¤„ç† `.tar.gz`ã€`.tar.bz2` ç­‰å¤åˆåç¼€ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ `pathlib.Path`ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚

---

### ğŸ†• æ›´ç°ä»£çš„æ–¹å¼ï¼šä½¿ç”¨ `pathlib.Path`

Python 3.4+ æ¨èä½¿ç”¨ `pathlib` æ¨¡å—ï¼Œæ›´é¢å‘å¯¹è±¡ã€åŠŸèƒ½æ›´å¼ºã€‚

```python
from pathlib import Path

p = Path("data.tar.gz")

print(p.stem)   # data.tar ï¼ˆå»æ‰æœ€åä¸€ä¸ªæ‰©å±•åï¼‰
print(p.suffix) # .gz

# å¤šå±‚æ‰©å±•åå¤„ç†
print(p.suffixes)  # ['.tar', '.gz']
print(p.with_suffix(''))  # data.tar ï¼ˆå»æ‰æœ€åä¸€ä¸ªåç¼€ï¼‰
```

---

###  å®é™…åº”ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šæ‰¹é‡é‡å‘½åæ–‡ä»¶ï¼Œä¿ç•™åŸæ‰©å±•å

```python
import os

filename = "photo.jpg"
root, ext = os.path.splitext(filename)
new_filename = f"resized_{root}{ext}"
print(new_filename)  # resized_photo.jpg
```

#### åœºæ™¯2ï¼šç­›é€‰ç‰¹å®šç±»å‹çš„æ–‡ä»¶ï¼ˆå¦‚ `.txt`ï¼‰

```python
import os

for file in os.listdir("."):
    if os.path.isfile(file):
        _, ext = os.path.splitext(file)
        if ext == ".txt":
            print("æ–‡æœ¬æ–‡ä»¶:", file)
```

---

### ğŸ§  æ€»ç»“

| åŠŸèƒ½                 | æ–¹æ³•                                               |
| -------------------- | -------------------------------------------------- |
| åˆ†å‰²æ–‡ä»¶åå’Œæ‰©å±•å   | `os.path.splitext("file.txt") â†’ ('file', '.txt')`  |
| è·å–ä¸å«æ‰©å±•çš„æ–‡ä»¶å | `root = os.path.splitext(filename)[0]`             |
| æ·»åŠ /æ›¿æ¢æ‰©å±•å      | `newname = root + ".bak"`                          |
| æ›´å¼ºå¤§çš„æ‰©å±•åå¤„ç†   | ä½¿ç”¨ `pathlib.Path().suffix`, `.stem`, `.suffixes` |

---

å¦‚æœä½ æ­£åœ¨å†™è„šæœ¬ã€æ‰¹é‡å¤„ç†æ–‡ä»¶æˆ–å¼€å‘å·¥å…·ç±»ç¨‹åºï¼Œ`os.path.splitext()` æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å°å·¥å…·ã€‚