location ~ /(product|shop)/ {
        if ($fingerprint_passed = 0) {
            add_header Content-Type "text/html; charset=utf-8";
            # 使用 503 状态码对 SEO 更友好（表示临时检查）
            return 503 '
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>Verifying your browser...</title>
                <style>body{font-family:sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column;}</style>
            </head>
            <body>
                <h2>Just a moment...</h2>
                <p>Please wait while we verify your browser.</p>
                <script>
                    (function() {
                        var token = "secure_v2_$remote_addr$http_user_agent_your_random_salt";
                        document.cookie = "auth_token=" + token + "; path=/; max-age=86400; SameSite=Lax";
                        setTimeout(function(){ location.reload(); }, 500);
                    })();
                </script>
            </body>
            </html>';
        }

        # 正常业务逻辑
        try_files $uri $uri/ /index.php?$args;
}