# 根据ip限制访问(容易误伤,并且对爬虫不利)
# ============================================
# 国家白名单 (使用 Cloudflare CF-IPCountry)
# ============================================


# 方案1:ip黑名单
# 屏蔽CN地区IP访问(基于可信的Cloudflare的CF-IPCountry头部信息,为了避免伪造该头部,建议配合 cf-realip.conf )
map $http_cf_ipcountry $block_cn {
    default 0;
    CN 1;
}
# 方案2:
# ip白名单1(严格,按国家,大规模多国家ip攻击时使用)
map $http_cf_ipcountry $allowed_country {
    default 0;      # 默认: 拒绝
    ""      1;      # 空值时允许 (可能是直接访问(没走cf)，建议配合其他安全措施)
    US      1;      # 🇺🇸 美国
    GB      1;      # 🇬🇧 英国(一般是GB,有些地方也可能是UK,Cloudflare 使用 ISO 3166-1 代码，英国是 GB 不是 UK)
    # UK      1;

    DE      1;      # 🇩🇪 德国
    FR      1;      # 🇫🇷 法国
    IT      1;      # 🇮🇹 意大利
    ES      1;      # 🇪🇸 西班牙
}
# ip白名单2(宽松,按语系)
    # 白名单逻辑：
# - 英语系: US, GB, CA, AU, NZ, IE
# - 德语系: DE, AT, CH
# - 法语系: FR, BE, CH, CA, LU, MC
# - 意大利语系: IT, CH, SM, VA
# - 西班牙语系: ES, MX, AR, CO, CL, PE, VE, EC, GT, CU, BO, DO, HN, PY, SV, NI, CR, PA, UY, PR, GQ
# ============================================
map $http_cf_ipcountry $allowed_country_lang {
    default 0;
    
    # 空值 (直接访问/无CF头)
    ""      1;
    
    # -------- 英语系国家 --------
    US      1;      # 🇺🇸 美国
    GB      1;      # 🇬🇧 英国
    CA      1;      # 🇨🇦 加拿大
    AU      1;      # 🇦🇺 澳大利亚
    NZ      1;      # 🇳🇿 新西兰
    IE      1;      # 🇮🇪 爱尔兰
    
    # -------- 德语系国家 --------
    DE      1;      # 🇩🇪 德国
    AT      1;      # 🇦🇹 奥地利
    CH      1;      # 🇨🇭 瑞士 (德/法/意)
    LI      1;      # 🇱🇮 列支敦士登
    
    # -------- 法语系国家 --------
    FR      1;      # 🇫🇷 法国
    BE      1;      # 🇧🇪 比利时
    LU      1;      # 🇱🇺 卢森堡
    MC      1;      # 🇲🇨 摩纳哥
    
    # -------- 意大利语系国家 --------
    IT      1;      # 🇮🇹 意大利
    SM      1;      # 🇸🇲 圣马力诺
    VA      1;      # 🇻🇦 梵蒂冈
    
    # -------- 西班牙语系国家 --------
    ES      1;      # 🇪🇸 西班牙
    MX      1;      # 🇲🇽 墨西哥
    AR      1;      # 🇦🇷 阿根廷
    CO      1;      # 🇨🇴 哥伦比亚
    CL      1;      # 🇨🇱 智利
    PE      1;      # 🇵🇪 秘鲁
    VE      1;      # 🇻🇪 委内瑞拉
    EC      1;      # 🇪🇨 厄瓜多尔
    GT      1;      # 🇬🇹 危地马拉
    CU      1;      # 🇨🇺 古巴
    BO      1;      # 🇧🇴 玻利维亚
    DO      1;      # 🇩🇴 多米尼加
    HN      1;      # 🇭🇳 洪都拉斯
    PY      1;      # 🇵🇾 巴拉圭
    SV      1;      # 🇸🇻 萨尔瓦多
    NI      1;      # 🇳🇮 尼加拉瓜
    CR      1;      # 🇨🇷 哥斯达黎加
    PA      1;      # 🇵🇦 巴拿马
    UY      1;      # 🇺🇾 乌拉圭
    PR      1;      # 🇵🇷 波多黎各
    GQ      1;      # 🇬🇶 赤道几内亚
}